stages:
    - test
    - lint
    - coverage

variables:
  MAVEN_OPTS: -Dmaven.repo.local=/cache/maven.repository  # cache maven repo
  REGISTRY_URI: http://localhost:8001
  CONFIG_URL: http://localhost:8000

java-tests:
    image: maven:latest
    stage: test
    script:
        - mvn test -PskipAngular

java-lint:
    image: maven:latest
    stage: lint
    script:
        - mvn pmd:check

java-coverage:
    image: maven:latest
    stage: coverage
    script:
        - mvn jacoco:prepare-agent install jacoco:report -PskipAngular

angular-lint:
    image: node:latest
    stage: lint
    script:
        - cd ui/src/main/resources/frontend && npm install && ./node_modules/@angular/cli/bin/ng lint

angular-test:
    image: node:13-stretch
    before_script:
        - apt-get update
        - apt-get install gconf-service libasound2 libatk1.0-0 libatk-bridge2.0-0 libc6 libcairo2 libcups2 libdbus-1-3 libexpat1 libfontconfig1 libgcc1 libgconf-2-4 libgdk-pixbuf2.0-0 libglib2.0-0 libgtk-3-0 libnspr4 libpango-1.0-0 libpangocairo-1.0-0 libstdc++6 libx11-6 libx11-xcb1 libxcb1 libxcomposite1 libxcursor1 libxdamage1 libxext6 libxfixes3 libxi6 libxrandr2 libxrender1 libxss1 libxtst6 ca-certificates fonts-liberation libappindicator1 libnss3 lsb-release xdg-utils wget -y
    stage: test
    script:
        - cd ui/src/main/resources/frontend && npm install && ./node_modules/@angular/cli/bin/ng test