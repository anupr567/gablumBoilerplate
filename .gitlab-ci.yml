stages:
    - build
    - test

variables:
  MAVEN_OPTS: -Dmaven.repo.local=/cache/maven.repository  # cache maven repo for faster builds

java-build:
    image: maven:3.6.0-jdk-11
    stage: build
    script:
        - mvn package -PskipAngular -DskipTests


java-tests:
    image: maven:3.6.0-jdk-11
    stage: test
    script:
        - mvn test -PskipAngular

java-lint:
    image: maven:3.6.0-jdk-11
    stage: test
    script:
        - mvn pmd:check

java-coverage:
    image: maven:3.6.0-jdk-11
    stage: test
    script:
        - mvn jacoco:prepare-agent install jacoco:report -PskipAngular

angular-build:
    image: node:12-buster
    stage: build
    script:
        - cd ui/src/main/resources/frontend && npm install && ./node_modules/@angular/cli/bin/ng build

angular-lint:
    image: node:12-buster
    stage: test
    script:
        - cd ui/src/main/resources/frontend && npm install && ./node_modules/@angular/cli/bin/ng lint

angular-tests:
    image: circleci/node:12-browsers
    stage: test
    script:
        - cd ui/src/main/resources/frontend && npm install && ./node_modules/@angular/cli/bin/ng test